<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Service Mesh Communication Flows :: Red Hat Service Mesh - Troubleshooting</title>
    <link rel="canonical" href="http://localhost:3000/rhs-build-course/index.html/rh-service-mesh-v2-troubleshooting/03-flows.html">
    <link rel="prev" href="02-jumpapp.html">
    <link rel="next" href="04-ingress-traffic.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../_/css/site.css">
<link rel="icon" href="../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img
          src="../_/img/header_logo.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" href="http://localhost:3000/rhs-build-course/index.html">Red Hat Service Mesh - Troubleshooting</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Books</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">CheatSheets</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">CheatSheet A</a>
            <a class="navbar-item" href="#">CheatSheet B</a>
            <a class="navbar-item" href="#">CheatSheet C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Upcoming Events</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Event A</a>
            <a class="navbar-item" href="#">Event B</a>
            <a class="navbar-item" href="#">Event C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Tutorial A</a>
            <a class="navbar-item" href="#">Tutorial B</a>
            <a class="navbar-item" href="#">Tutorial C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="rh-service-mesh-v2-troubleshooting" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Red Hat Service Mesh - Troubleshooting</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="01-setup.html">1. Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#prerequisites">1.1 Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#laboratory">1.2 Laboratory</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-jumpapp.html">2. Jump App Deployment</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-jumpapp.html#login">2.1 Login in Openshift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-jumpapp.html#github">2.2 Clone GitHub Repository</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-jumpapp.html#jumpappobjects">2.3 Create Jump App Objects in Openshift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-jumpapp.html#test">2.4 Confirm Jump App is already running in Openshift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-jumpapp.html#testapp">2.5 Access to Jump App</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="03-flows.html">3. Service Mesh Communication Flows</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#create">3.1 Create Red Hat Service Mesh Traffic Flow objects</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#gw">3.1.1 Gateways</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#vsvc">3.1.2 Virtual Services</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#dr">3.1.3 Destination Rules</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#services">3.1.4 K8s Services</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#memberrol">3.2 Added a new project to Red Hat Service Mesh Control Plane</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#finalsteps">3.3 Final steps</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#annotation">3.3.1 Add Istio Sidecar annotation in Jump App deployments</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#routes">3.3.2 Configure Routes</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#test">3.4 Confirm Jump App is running again</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#03-kiali">3.5 Visit Kiali</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="04-ingress-traffic.html">4. Service Mesh Ingress Traffic Flow</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-ingress-traffic.html#04-ingress">4.1 Introduction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-ingress-traffic.html#04-troubleshooting">4.2 Ingress Gateway Traffic Flow Troubleshooting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="04-ingress-traffic.html#04-customize">4.3 Customize Jump App</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-ingress-traffic.html#04-cust-state">4.3.1 Confirm <em>Jump App</em> state</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="04-ingress-traffic.html#04-router">4.4 Openshift Router &#8594; Ingress Gateway Connectivity</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-ingress-traffic.html#04-trou-con">4.4.1 Test connectivity via command line</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-ingress-traffic.html#04-trou-fix">4.4.2 Fix configuration problems</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-ingress-traffic.html#04-trou-con-again">4.4.3 Test connectivity again via command line</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="04-ingress-traffic.html#04-gateway">4.5 Ingress Gateway &#8594; Sidecar Connectivity</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-ingress-traffic.html#04-gateway-con">4.5.1 Test connectivity via command line</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-ingress-traffic.html#04-gateway-fix">4.5.2 Fix configuration problems</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-ingress-traffic.html#04-gateway-con-again">4.5.3 Test connectivity again via command line</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-ingress-traffic.html#04-gateway-fix2">4.5.4 Fix configuration problems</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-ingress-traffic.html#04-gateway-con-again2">4.5.5 Test connectivity again via command line</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="04-ingress-traffic.html#04-sidecar">4.6 Sidecar &#8594; App Connectivity</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-ingress-traffic.html#04-sidecar-con">4.6.1 Test connectivity via command line</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-ingress-traffic.html#04-test">4.7 Confirm <em>Jump App</em> is running again</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-ingress-traffic.html#04-kiali">4.8 Visit Kiali</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="05-secure-ingress-traffic.html">5. Secure Ingress Traffic Troubleshooting</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="05-secure-ingress-traffic.html#05-sds">5.1 Secure Gateways with SDS</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05-secure-ingress-traffic.html#05-sds-addcert">5.1.1 Create in Istio the Custom Certificate using SDS</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05-secure-ingress-traffic.html#05-sds-route">5.1.2 Modify back-golang Route in istio-system Namespace</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05-secure-ingress-traffic.html#05-sds-gw">5.1.3 Configure Gateway</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="05-secure-ingress-traffic.html#05-test-fail">5.2 Confirm <em>Jump App</em> is running</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="05-secure-ingress-traffic.html#05-router">5.3 Openshift Router &#8594; Ingress Gateway Secure Connectivity</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05-secure-ingress-traffic.html#05-trou-con">5.3.1 Test connectivity via command line</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05-secure-ingress-traffic.html#05-trou-fix">5.3.2 Fix configuration problems</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05-secure-ingress-traffic.html#05-trou-fix">5.3.3 Fix configuration problems</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="05-secure-ingress-traffic.html#05-gateway">5.4 Ingress Gateway &#8594; Envoy Sidecar Secure Connectivity</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05-secure-ingress-traffic.html#05-trou-gateway-forcessl">5.4.1 Force mTLS in your namespace</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05-secure-ingress-traffic.html#05-trou-gateway-con">5.4.2 Test connectivity via command line</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05-secure-ingress-traffic.html#05-trou-gateway-evoy-con">5.4.3 Emulate regular <em>Ingress Gateway</em> connectivity via command line</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="05-secure-ingress-traffic.html#05-test">5.5 Confirm <em>Jump App</em> is running again</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="05-secure-ingress-traffic.html#05-kiali">5.5 Visit Kiali</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="06-egress-traffic.html">6. Egress Traffic Troubleshooting</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="06-egress-traffic.html#06-sds">6.1 Secure Egress Traffic with mTLS</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="06-egress-traffic.html#06-createservice">6.2 Create the <em>External Service</em></a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="06-egress-traffic.html#06-addcert">6.2.1 Add a Custom Certificate</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="06-egress-traffic.html#06-createnginx">6.2.2 Create Nginx service</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="06-egress-traffic.html#06-createtesting">6.3 Create the Testing Microservice</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="06-egress-traffic.html#06-createtestingcerts">6.3.1 Add a Custom Certificate</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="06-egress-traffic.html#06-createtestingdepl">6.3.2 Create Testing Tool Deployment</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="06-egress-traffic.html#06-createsevs">6.3.3 Configure Nginx service Istio Objects</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="06-egress-traffic.html#06-createsevstest">6.3.4 Test Nginx service through testing tool</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="06-egress-traffic.html#06-configureegressaccess">6.4 Configure mutual TLS origination for egress traffic</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="06-egress-traffic.html#06-configureegressaccesstest">6.4.1 Testing egress traffic</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="06-egress-traffic.html#06-finalquestion">6.5 Final Question</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="07-tools.html">7. Troubleshooting Tools</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Red Hat Service Mesh - Troubleshooting</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Red Hat Service Mesh - Troubleshooting</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Red Hat Service Mesh - Troubleshooting</a></li>
    <li><a href="03-flows.html">3. Service Mesh Communication Flows</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/acidonper/rh-service-mesh-v2-troubleshooting/edit/master/documentation/modules/ROOT/pages/03-flows.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Service Mesh Communication Flows</h1>
<div class="sect1">
<h2 id="create"><a class="anchor" href="#create"></a>Create Red Hat Service Mesh Traffic Flow objects</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to make an application available through Service Mesh, it is required to create a set of Service Mesh objects related to the traffic flow:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Gateways - Describes a load balancer operating at the edge of the mesh receiving incoming or outgoing HTTP/TCP connections (Please, visit this link <a href="https://istio.io/v1.6/docs/concepts/traffic-management/#gateways">Gateways</a> for more information about <em>gateways</em>)</p>
</li>
<li>
<p>Virtual Services - Defines a set of traffic routing rules to apply when a host is addressed (Please, visit this link <a href="https://istio.io/v1.6/docs/concepts/traffic-management/#virtual-services">Virtual Services</a> for more information about <em>virtual services</em>)</p>
</li>
<li>
<p>Destination Rules - Defines policies that apply to traffic intended for a service after routing has occurred (Please, visit this link <a href="https://istio.io/v1.6/docs/concepts/traffic-management/#destination-rules">Destination Rules</a> for more information about <em>destination rules</em>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this step, you have to be able to deploy these <em>Jump App</em> Service Mesh objects in order to introduce this application in the Service Mesh and publish it to external clients.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Please, replace <strong>&lt;user_namespace&gt;</strong> with the value provided by the Instructor at the beginning of this tutorial.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="gw"><a class="anchor" href="#gw"></a>Gateways</h3>
<div class="paragraph">
<p>First of all, it is required to create a Gateway for external access. In the <em>Jump App</em> architecture, you have a couple of services which have to be exposed to external clients in order to present the Frontend and Backend services.</p>
</div>
<div class="paragraph">
<p>Please, return to git repository and create <strong>gateways</strong> through the respective Openshift template executing the following command:</p>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc process -f 03-jump-app-flows/00-jump-app-gws.yaml --param-file=params.env --ignore-unknown-parameters | oc apply -f - -n &lt;user_namespace&gt;</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/jump-app-gws-ok.png" alt="jump app gws ok">
</div>
<div class="title">Figure 1. Gateways Created</div>
</div>
</div>
<div class="sect2">
<h3 id="vsvc"><a class="anchor" href="#vsvc"></a>Virtual Services</h3>
<div class="paragraph">
<p>Once gateways are created and the application is reacheabled, it is time to create the traffic rules inside your namespace in order to route this traffic to the specific endpoint.</p>
</div>
<div class="paragraph">
<p>Please, create new <strong>virtual services</strong> through the respective Openshift template executing the following command:</p>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc process -f 03-jump-app-flows/01-jump-app-vss.yaml --param-file=params.env --ignore-unknown-parameters | oc apply -f - -n &lt;user_namespace&gt;</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/jump-app-vss-ok.png" alt="jump app vss ok">
</div>
<div class="title">Figure 2. Virtual Services Created</div>
</div>
</div>
<div class="sect2">
<h3 id="dr"><a class="anchor" href="#dr"></a>Destination Rules</h3>
<div class="paragraph">
<p>Once previous objects are created, it is required  to define the policies which will be applied to traffic intended for a service after routing has occurred.</p>
</div>
<div class="paragraph">
<p>Please, create new <strong>destination rules</strong> through the respective Openshift template executing the following command:</p>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc process -f 03-jump-app-flows/02-jump-app-drs.yaml --param-file=params.env --ignore-unknown-parameters | oc apply -f - -n &lt;user_namespace&gt;</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/jump-app-drs-ok.png" alt="jump app drs ok">
</div>
<div class="title">Figure 3. Destination Rules Created</div>
</div>
</div>
<div class="sect2">
<h3 id="services"><a class="anchor" href="#services"></a>K8s Services</h3>
<div class="paragraph">
<p>Once you have created gateways, virtual services and destination rules, it is time to include a specific annotation in your app deployments in order to allow Service Mesh control and run the respective envoy sidecar automatically.</p>
</div>
<div class="paragraph">
<p>Please, create new <strong>k8s services</strong> through the respective Openshift template executing the following command:</p>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc process -f 03-jump-app-flows/03-jump-app-services.yaml --param-file=params.env --ignore-unknown-parameters | oc apply -f - -n &lt;user_namespace&gt;</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/jump-app-svcs-ok.png" alt="jump app svcs ok">
</div>
<div class="title">Figure 4. k8s Services Created</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="memberrol"><a class="anchor" href="#memberrol"></a>Added a new project to Red Hat Service Mesh Control Plane</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The ServiceMeshMemberRoll lists the projects belonging to the control plane. Only projects listed in the ServiceMeshMemberRoll are affected by the control plane.</p>
</div>
<div class="paragraph">
<p>In order to add this new project to the Service Mesh and make the traffic between each microservice possible, it is required to create a new <em>ServiceMeshMember</em> object.</p>
</div>
<div class="paragraph">
<p>Please, create the previous object through the respective Openshift template executing the following command:</p>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc process -f 03-jump-app-flows/04-jump-app-ns-smr.yaml --param-file=params.env --ignore-unknown-parameters | oc apply -f - -n &lt;user_namespace&gt;</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/jump-app-ns-smr.png" alt="jump app ns smr">
</div>
<div class="title">Figure 5. <em>ServiceMeshMember</em> Created</div>
</div>
<div class="paragraph">
<p>Additionally, you are able to check this new object through the Openshift Console:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/jump-app-ns-smr-con1.png" alt="jump app ns smr con1">
</div>
<div class="title">Figure 6. <em>ServiceMeshMember</em> Created Console- 1</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/jump-app-ns-smr-con2.png" alt="jump app ns smr con2">
</div>
<div class="title">Figure 7. <em>ServiceMeshMember</em> Created Console - 2</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/jump-app-ns-smr-con3.png" alt="jump app ns smr con3">
</div>
<div class="title">Figure 8. <em>ServiceMeshMember</em> Created Console - 3</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="finalsteps"><a class="anchor" href="#finalsteps"></a>Final Steps</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="annotation"><a class="anchor" href="#annotation"></a>Add <em>Istio Sidecar</em> annotation in <em>Jump App</em> deployments</h3>
<div class="paragraph">
<p>Once traffic flow objects are created and your namespace is included as a member in the Service Mesh Control Plane, it is time to include a specific annotation in your app deployments in order to allow Service Mesh control and run the respective envoy sidecar automatically.</p>
</div>
<div class="paragraph">
<p>Please, edit each <em>Jump App Microservice</em> deployment executing the commands added below:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-input hljs" data-lang="input">oc patch deployment front-javascript-v1 -p '{"spec":{"template":{"metadata":{"annotations":{"sidecar.istio.io/inject":"true"}}}}}' -n &lt;user_namespace&gt;</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/jump-app-front-depl-patch.png" alt="jump app front depl patch">
</div>
<div class="title">Figure 9. Front Patched</div>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-input hljs" data-lang="input">oc patch deployment back-springboot-v1 -p '{"spec":{"template":{"metadata":{"annotations":{"sidecar.istio.io/inject":"true"}}}}}' -n &lt;user_namespace&gt;</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/jump-app-back-spb-depl-patch.png" alt="jump app back spb depl patch">
</div>
<div class="title">Figure 10. Back Springboot Patched</div>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-input hljs" data-lang="input">oc patch deployment back-python-v1 -p '{"spec":{"template":{"metadata":{"annotations":{"sidecar.istio.io/inject":"true"}}}}}' -n &lt;user_namespace&gt;</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/jump-app-back-py-depl-patch.png" alt="jump app back py depl patch">
</div>
<div class="title">Figure 11. Back Python Patched</div>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-input hljs" data-lang="input">oc patch deployment back-golang-v1 -p '{"spec":{"template":{"metadata":{"annotations":{"sidecar.istio.io/inject":"true"}}}}}' -n &lt;user_namespace&gt;</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/jump-app-back-go-depl-patch.png" alt="jump app back go depl patch">
</div>
<div class="title">Figure 12. Back Golang Patched</div>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-input hljs" data-lang="input">oc patch deployment mongo -p '{"spec":{"template":{"metadata":{"annotations":{"sidecar.istio.io/inject":"true"}}}}}' -n &lt;user_namespace&gt;</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/jump-app-back-mg-depl-patch.png" alt="jump app back mg depl patch">
</div>
<div class="title">Figure 13. MongoDB Patched</div>
</div>
<div class="paragraph">
<p>Before continuing with the following steps, please test Jump App <em>pods</em> status, in order to be sure that 2 replicas are running for each microservice:</p>
</div>
<div class="listingblock lines_7 console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-input hljs" data-lang="input">oc get pods</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/jump-app-pods-2-ok.png" alt="jump app pods 2 ok">
</div>
<div class="title">Figure 14. Jump App Pods Mesh</div>
</div>
</div>
<div class="sect2">
<h3 id="routes"><a class="anchor" href="#routes"></a>Configure Routes</h3>
<div class="paragraph">
<p>An OpenShift Container Platform <strong>route</strong> exposes a service at a host name, such as www.example.com, so that external clients can reach it by name. When you manage routes outside Service Mesh, it is required to create these objects in each namespace.</p>
</div>
<div class="paragraph">
<p>Once you have a project integrated in Service Mesh, routes should be created in istio-system, or wherever the control plane is installed, to make this external service available through the Istio Ingress Gateway. For this reason, it is required to follow the next steps:</p>
</div>
<div class="sect3">
<h4 id="_delete_all_current_routes_in_user_namespace"><a class="anchor" href="#_delete_all_current_routes_in_user_namespace"></a><strong>Delete all current routes in &lt;user_namespace&gt;</strong></h4>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-input hljs" data-lang="input">oc get routes -n &lt;user_namespace&gt; | grep -v NAME | awk '{print "oc delete route " $1}' | sh</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/jump-app-route-del.png" alt="jump app route del">
</div>
<div class="title">Figure 15. Jump App Routes Deleted</div>
</div>
</div>
<div class="sect3">
<h4 id="_create_a_new_routes_in_istio_system"><a class="anchor" href="#_create_a_new_routes_in_istio_system"></a><strong>Create a new routes in istio-system</strong></h4>
<div class="paragraph">
<p>Once "regular" routes are deleted, it is required to create the new ones.</p>
</div>
<div class="paragraph">
<p>Please, create new <strong>routes</strong> in <strong>istio-system</strong> namespace through the respective Openshift template executing the following command:</p>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc process -f 03-jump-app-flows/05-jump-app-routes.yaml --param-file=params.env --ignore-unknown-parameters | oc create -f - -n istio-system</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/jump-app-routes-mesh-ok.png" alt="jump app routes mesh ok">
</div>
<div class="title">Figure 16. Mesh Routes Created</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="test"><a class="anchor" href="#test"></a>Confirm <em>Jump App</em> is running again</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once <em>Jump App</em> objects have been created in Openshift, it is required to follow the next steps in order to ensure your demo app is running properly:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Look at the number of containers in each microservice, it must contains 2 container per each pod (<strong>READY 2/2</strong>).
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Get pods</p>
</li>
</ul>
</div>
<div class="listingblock lines_7 console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-input hljs" data-lang="input">oc get pods</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/jump-app-pods-2-ok.png" alt="jump app pods 2 ok">
</div>
<div class="title">Figure 17. Jump App Pods Mesh</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Obtain external services URLs</p>
</li>
</ul>
</div>
<div class="listingblock lines_7 console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-input hljs" data-lang="input">oc get routes -n istio-system | grep &lt;user_namespace&gt;</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/jump-app-get-routes-mesh-ok.png" alt="jump app get routes mesh ok">
</div>
<div class="title">Figure 18. Jump App Routes</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Visit the <strong>back</strong>, <em>back-golang-&lt;user_namespace&gt;.&lt;openshift_apps_domain&gt;</em>, route via your web browser</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/jump-app-back-ok.png" alt="jump app back ok">
</div>
<div class="title">Figure 19. Jump App Back</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Visit the <strong>front</strong>, <em>front-javascript-&lt;user_namespace&gt;.&lt;openshift_apps_domain&gt;</em>, route via your web browser. In addition, configure <strong>[ 10000 ]</strong> retries with <strong>[ 1 ]</strong> interval and press <strong>[ JUMP ]</strong> and ensure the following message is displaying in your screen</p>
<div class="literalblock">
<div class="content">
<pre>...{"code":200,"message":"/jump - Greetings from Python!"}</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/jump-app-front-jumps-ok.png" alt="jump app front jumps ok">
</div>
<div class="title">Figure 20. Jump App Front Web UI Multi Jumps</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
It is required to accept <strong>self-signed certificates</strong> provided by Openshift
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/certs_warning.png" alt="certs warning" width="50%">
</div>
<div class="title">Figure 21. Openshift Self-signed Certificates Warning</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="03-kiali"><a class="anchor" href="#03-kiali"></a>Visit Kiali</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Jump App is generating traffic flow thanks to the frontend where it was given an specific number of continuous jumps. In order to review the Service Mesh traffic flow in your project, please visit the Kiali console <strong>&lt;kiali_url&gt;</strong> (<em>E.g. <a href="https://kiali-istio-system.apps.tutorialrhmesh.sandbox507.opentlc.com" class="bare">https://kiali-istio-system.apps.tutorialrhmesh.sandbox507.opentlc.com</a></em>):</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/jump-app-kiali.png" alt="jump app kiali">
</div>
<div class="title">Figure 22. Kiali Console</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="02-jumpapp.html">2. Jump App Deployment</a></span>
  <span class="next"><a href="04-ingress-traffic.html">4. Service Mesh Ingress Traffic Flow</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
